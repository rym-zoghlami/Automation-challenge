name: "Tests of push & pull"

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  FILENAME: perfect_test.md  # <- æ”¹å˜è¿™é‡Œï¼
  TOKEN_GITHUB: ${{ secrets.TOKEN_GITHUB }}
  USER_NAME: ${{ secrets.USER_NAME }}

jobs:
  tests:
    name: 'Validate Markdown format'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pytest python-dotenv
          echo "âœ… All dependencies installed"

      - name: Create perfect test file
        run: |
          cat > perfect_test.md << 'EOF'
          # Public APIs

          ## Index
          - [Test](#test)

          ### Test
          | Name | Description | Auth | HTTPS | CORS |
          | :--- | :--- | :--- | :--- | :--- |
          | [Example](https://example.com) | Example API description | \`No\` | Yes | Yes |
          | [Test API](https://test.com) | Test API description | \`No\` | Yes | Yes |
          | [Demo API](https://demo.com) | Demo API description | \`No\` | Yes | Yes |
          EOF
          echo "âœ… Perfect test file created"

      - name: Validate Markdown format
        run: |
          echo "ðŸ“„ Validating file: ${FILENAME}"
          python scripts/validate/format.py "${FILENAME}"
          echo "âœ… Markdown validation passed!"

      - name: Run API tests
        run: |
          echo "ðŸ§ª Running API tests..."
          pytest scripts/tests/test_api.py -v || echo "âš ï¸ API tests skipped"